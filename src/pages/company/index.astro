---
import MainLayout from '@/layouts/MainLayout.astro';
import { companies } from '@/data/companies';

const pageTitle = "Company Funding Database - Latest Funding Rounds | Tying.ai";
const pageDescription = "Browse the latest company funding rounds, investments, and startup news. Track Series A, B, C rounds and seed funding across tech companies.";

// SEO 优化配置
const keywords = "startup funding, venture capital, series A, series B, series C, seed funding, company funding, investment rounds, VC funding, tech startups, funding news, investor database, funding rounds 2025";

const ogImage = "https://placehold.co/1200x630/667eea/ffffff/png?text=Company+Funding+Database&font=inter";

// 结构化数据 - ItemList schema 用于公司列表
const customStructuredData = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "Company Funding Database",
  "description": pageDescription,
  "numberOfItems": companies.length,
  "itemListElement": companies.slice(0, 10).map((company, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "item": {
      "@type": "Organization",
      "name": company.name,
      "url": company.website,
      "description": `${company.name} raised ${company.round} on ${company.date}`,
      "funding": {
        "@type": "MonetaryGrant",
        "name": company.round,
        "funder": {
          "@type": "Organization",
          "name": company.leadInvestor
        }
      }
    }
  }))
};
---

<MainLayout
  title={pageTitle}
  description={pageDescription}
  keywords={keywords}
  image={ogImage}
  customStructuredData={customStructuredData}
>
  <div class="py-24">
    <!-- 页面标题和搜索框 - 保持 900px 居中 -->
    <div class="max-w-notion-wide mx-auto px-8 mb-12">
      <!-- 页面标题 -->
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-notion-text mb-4">
          Company Funding Database
        </h1>
        <p class="text-lg text-notion-text-light">
          Browse the latest company funding rounds, investments, and startup news. Track {companies.length}+ companies with detailed funding information.
        </p>
      </div>

      <!-- 搜索框 -->
      <div>
        <input
          type="text"
          id="searchInput"
          placeholder="Search companies, investors, or rounds..."
          class="w-full px-4 py-3 border border-notion-border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          aria-label="Search companies"
        />
      </div>
    </div>

    <!-- 公司表格 - 使用更宽的容器 -->
    <div class="max-w-[1400px] mx-auto px-8">
      <div class="overflow-x-auto rounded-lg shadow-sm border border-notion-border">
      <table class="w-full border-collapse bg-white text-sm" id="companyTable">
        <thead class="bg-notion-gray-10 sticky top-0 z-10">
          <tr>
            <th class="px-4 py-3 text-left font-semibold text-notion-text border-b-2 border-notion-border whitespace-nowrap">Company</th>
            <th class="px-4 py-3 text-left font-semibold text-notion-text border-b-2 border-notion-border whitespace-nowrap">Round</th>
            <th class="px-4 py-3 text-left font-semibold text-notion-text border-b-2 border-notion-border whitespace-nowrap">Date</th>
            <th class="px-4 py-3 text-left font-semibold text-notion-text border-b-2 border-notion-border whitespace-nowrap">Lead Investor</th>
            <th class="px-4 py-3 text-left font-semibold text-notion-text border-b-2 border-notion-border whitespace-nowrap">Homepage</th>
            <th class="px-4 py-3 text-left font-semibold text-notion-text border-b-2 border-notion-border whitespace-nowrap">Jobs Page</th>
            <th class="px-4 py-3 text-left font-semibold text-notion-text border-b-2 border-notion-border whitespace-nowrap">News</th>
          </tr>
        </thead>
        <tbody>
          {companies.map((company) => (
            <tr class="border-b border-notion-border hover:bg-notion-gray-10 transition-colors">
              <td class="px-4 py-3 font-semibold text-notion-text whitespace-nowrap">{company.name}</td>
              <td class="px-4 py-3 whitespace-nowrap">
                <span class="inline-block px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-medium whitespace-nowrap">
                  {company.round}
                </span>
              </td>
              <td class="px-4 py-3 text-notion-text-light whitespace-nowrap">{company.date}</td>
              <td class="px-4 py-3 text-notion-text-light text-sm">{company.leadInvestor}</td>
              <td class="px-4 py-3 whitespace-nowrap">
                <a
                  href={company.website}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-blue-600 hover:text-blue-700 hover:underline"
                >
                  Website
                </a>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <a
                  href={company.jobs}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-blue-600 hover:text-blue-700 hover:underline"
                >
                  Jobs
                </a>
              </td>
              <td class="px-4 py-3 whitespace-nowrap">
                <a
                  href={company.news}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-blue-600 hover:text-blue-700 hover:underline"
                >
                  News
                </a>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
      </div>
    </div>
  </div>
</MainLayout>

<!-- 搜索功能脚本 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput') as HTMLInputElement;
    const table = document.getElementById('companyTable') as HTMLTableElement;
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

    if (searchInput) {
      searchInput.addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();

        Array.from(rows).forEach(function(row) {
          const text = row.textContent?.toLowerCase() || '';
          (row as HTMLElement).style.display = text.includes(searchTerm) ? '' : 'none';
        });
      });
    }
  });
</script>
